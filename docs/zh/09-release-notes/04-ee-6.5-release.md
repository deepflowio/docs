---
title: v6.5 EE Release Notes
permalink: /release-notes/release-6.5-ee
---

# 零侵扰

## 追踪

- AutoTracing
  - ⭐ 增强对位于 SQL 语句注释中 TraceID、SpanID 的提取能力，[文档见此](../features/l7-protocols/sql/#mysql)。
  - ⭐ 新增 RabbitMQ AMQP 协议的解析能力，[文档见此](../features/l7-protocols/mq/#amqp)。
  - 支持提取 Kafka 协议头中的 `correlation_id` 为 `x_request_id_0/1`，自动追踪 Request-Response 模式的 Kafka 调用链；支持提取协议头中 traceparent 和 sw8 的 SpanID，增强追踪能力。
  - 将 MySQL 单向消息（`CLOSE`、`QUIT`）的日志类型直接标记为会话。
- AutoTagging
  - ⭐ 应用指标和调用日志增加业务类型（`biz_type`）标签，可配合 Wasm Plugin 使用标识业务类型。
  - ⭐ Kafka 协议支持提取 `topic_name` 为 `endpoint`，[文档见此](../features/l7-protocols/mq/#kafka)。
  - ⭐ 聚合指标中不再将广域网服务端聚合为 `0.0.0.0`，不再将无任何资源标签的私有 IP 地址（192.168、172.16、10、169.254）标记为广域网。
  - ⭐支持自定义采集 HTTP/HTTP2/gRPC 头部字段并存储于调用日志的 `attribute.$field_name` 字段中，[详见文档](../features/l7-protocols/http/#http)。
  - A/AAAA 类型的 DNS 请求，将 `QNAME` 提取为 `request_domain`，[文档见此](../features/l7-protocols/network/#dns)。
  - FastCGI、MQTT、DNS 协议支持提取 `endpoint` 字段，[文档见此](../features/l7-protocols/overview/)。
  - 所有数据增加容器节点、云服务器的主 IP（`pod_node_ip`、`chost_ip`）和主机名（`pod_node_hostname`、`chost_hostname`）标签。
- 易用性提升
  - 资源分析页面增加角色（Role）分组能力，用于区分资源作为客户端、服务端时的统计数据。
  - 支持记忆调用链追踪火焰图下方的 Tab 激活状态、稳定 Tab 布局。
  - 调用链追踪火焰图中的 Span 和下方表格中的调用日志联动高亮。
  - 优化搜索框切换至容器搜索或进程搜索模式时的加载速度。

## 剖析

- 易用性提升
  - 火焰图中的首行名称从 root 修改为 `$app_service`，即 eBPF 采集的进程名、或应用内部设置的服务名。
  - 优化搜索框切换至容器搜索或进程搜索模式时的加载速度。

## 网络

- AutoMetrics
  - 暴露流量分发指标，支持监控匹配特定流量分发策略的流量速率。
  - 异常指标改名：建连-客户端 SYN 结束（`client_syn_repeat`）改名为建连-服务端 SYN 缺失（`server_syn_miss`），并被算入`服务端异常`。
  - 异常指标改名：建连-服务端 SYN 结束（`server_syn_repeat`）改名为建连-客户端 ACK 缺失（`client_ack_miss`），并被算入`客户端异常`。
- AutoTagging
  - ⭐ 网络流日志中增加 `request_domain` 字段，与应用指标、调用日志自动关联。
  - ⭐ 聚合指标中不再将广域网服务端聚合为 `0.0.0.0`，不再将无任何资源标签的私有 IP 地址（192.168、172.16、10、169.254）标记为广域网。
  - 所有数据增加容器节点、云服务器的主 IP（`pod_node_ip`、`chost_ip`）和主机名（`pod_node_hostname`、`chost_hostname`）标签。
- 易用性提升
  - 资源分析页面增加角色（Role）分组能力，用于区分资源作为客户端、服务端时的统计数据。
  - 优化搜索框切换至容器搜索或进程搜索模式时的加载速度。

# 自定义

## 视图

- 易用性提升
  - 子视图编辑框增加指标设置功能。
  - 详情表格支持按开始时间、结束时间列排序。

## 全景图

# 集成

## 指标

## 日志

# 运营

## 告警

## 报表

# 管理

## 资源

- AutoTagging
  - 增强与平安云的资源信息同步能力，支持获取 Serverless 集群中租户 Pod 的 CIDR。
  - 企业版默认禁用 Agent 自动触发生成 Kubernetes 类型的云平台，简化 On-Prem 模式下的部署步骤。

## 系统

- SQL API
  - ⭐优化 Delay 和 BoundedGauge 类型指标量的 Percentile 算子，将编译后的 ClickHouse SQL 层数降低到一层。
  - ClickHouse 表名和字段名修改，见文末表格（废弃名依然可使用，<mark>但将会从 v7.0 开始停止支持</mark>）。
- Agent
  - ⭐默认开启系统负载熔断机制，当系统负载与 CPU 核数的比例超过 `system_load_circuit_breaker_threshold` 时 Agent 触发熔断机制自动进入禁用状态并告警，配置方法详见 Agent 配置样例。
  - ⭐优化 Redis 和 MySQL 协议解析性能：优化后 Agent 1CPU 300MB 内存可采集 5W TPS MySQL 或 Redis 流量。
- 部署
  - Agent 支持通过 Docker Compose 部署，[文档见此](../ce-install/legacy-host/)。

# 兼容性

## 不兼容修改

N/A

## 兼容修改

注意：如下修改将会在 v7.0 开始停止兼容。

ClickHouse `flow_metrics` 数据库中数据表名称修改：
| 旧名称                | 新名称            | 数据作用                      |
| --------------------- | ----------------- | ----------------------------- |
| `vtap_app_port`       | `application`     | 所有服务的应用性能指标        |
| `vtap_app_edge_port`  | `application_map` | 所有应用访问关系及其性能指标  |
| `vtap_flow_port`      | `network`         | 所有服务的网络性能指标        |
| `vtap_flow_edge_port` | `network_map`     | 所有网络访问关系及其性能指标  |
| `vtap_acl`            | `traffic_policy`  | 网络策略指标（仅企业版）      |

ClickHouse 数据库中字段名的修改：
| 旧名称              | 新名称                 | 数据作用                      |
| ------------------- | ---------------------- | ----------------------------- |
| `vtap`              | `agent`                | Agent                         |
| `vtap_id`           | `agent_id`             | Agent ID                      |
| `tap_side`          | `observation_point`    | 观测点                        |
| `tap`               | `capture_network_type` | 网络位置（仅企业版）          |
| `tap_port`          | `capture_nic`          | 采集网卡标识                  |
| `tap_port_name`     | `capture_nic_name`     | 采集网卡名称                  |
| `tap_port_type`     | `capture_nic_type`     | 采集网卡类型                  |
| `tap_port_host`     | `capture_nic_host`     | 采集网卡所属宿主机（仅企业版）|
| `tap_port_chost`    | `capture_nic_chost`    | 采集网卡所属云服务器          |
| `tap_port_pod_node` | `capture_nic_pod_node` | 采集网卡所属容器节点          |

----

